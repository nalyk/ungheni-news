{{- /* Canonical */ -}}
{{- if .Permalink -}}
<link rel="canonical" href="{{ .Permalink }}" />
{{- end -}}

{{- /* Hreflang alternates */ -}}
{{- if .IsPage -}}
  {{- range .AllTranslations -}}
    <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}" />
  {{- end -}}
  <link rel="alternate" hreflang="x-default" href="{{ .Permalink }}" />
{{- else -}}
  {{- range $.Sites -}}
    <link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Home.Permalink }}" />
  {{- end -}}
{{- end -}}

{{- /* Google Discover-friendly image previews */ -}}
<meta name="robots" content="max-image-preview:large" />

{{- /* Open Graph & Twitter Cards */ -}}
{{- $title := cond .IsHome .Site.Title (printf "%s Â· %s" .Title .Site.Title) -}}
{{- $seo := .Params.seo -}}
{{- $desc := or ($seo.meta_description | default nil) (or .Params.summary .Summary) | default .Site.Title | plainify | truncate 160 -}}
{{- $img := (or ($seo.social_image | default nil) (or .Params.cover (cond (in .Params.tags "politic") "img/placeholders/politic.svg" "img/placeholders/local.svg"))) | relURL -}}
{{- if .IsPage -}}
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="{{ (.PublishDate | default .Date).UTC.Format "2006-01-02T15:04:05Z07:00" }}" />
  <meta property="article:modified_time" content="{{ .Lastmod.UTC.Format "2006-01-02T15:04:05Z07:00" }}" />
{{- else -}}
  <meta property="og:type" content="website" />
{{- end -}}
<meta property="og:title" content="{{ or ($seo.social_title | default nil) $title }}" />
<meta property="og:description" content="{{ $desc }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />
<meta property="og:image" content="{{ $img | absURL }}" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ or ($seo.social_title | default nil) $title }}" />
<meta name="twitter:description" content="{{ $desc }}" />
<meta name="twitter:image" content="{{ $img | absURL }}" />
{{/* Structured data: WebSite + SearchAction (site-wide) */}}
{{- $base := .Site.BaseURL | absURL -}}
<script type="application/ld+json">
{{ dict 
  "@context" "https://schema.org" 
  "@type" "WebSite" 
  "url" $base 
  "name" .Site.Title 
  "potentialAction" (dict 
    "@type" "SearchAction" 
    "target" (printf "%ssearch/?q={search_term_string}" $base) 
    "query-input" "required name=search_term_string") 
  | jsonify }}
</script>

{{- if .IsHome -}}
  {{- $pub := site.Params.publisher | default .Site.Title -}}
  {{- $logo := "img/brand/logo.svg" | relURL | absURL -}}
  <script type="application/ld+json">
  {{ dict 
    "@context" "https://schema.org" 
    "@type" "Organization" 
    "name" $pub 
    "url" $base 
    "logo" $logo 
    "sameAs" (where (slice (.Site.Params.facebook_page | default "") (.Site.Params.twitter_site | default "")) "." "ne" "") 
   | jsonify }}
  </script>
{{- end -}}
