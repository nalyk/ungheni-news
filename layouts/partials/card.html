{{/*
  Card Component - Reusable Article Card
  
  Purpose: Display article cards consistently across listings (homepage, category pages, etc.)
  
  Parameters:
  - . (page context): The page/article to display as a card
  
  Features:
  - Responsive image handling with aspect ratio preservation
  - Accessible clickable card with proper focus states
  - Title clamping (2 lines max) and summary clamping (1 line max)
  - Date formatting and pills display
  - Graceful handling of missing images
  - Semantic HTML with microdata
  
  Usage: 
  {{ range .Pages }}
    {{ partial "card.html" . }}
  {{ end }}
*/}}

{{- $page := . -}}
{{- $title := $page.Title -}}
{{- $summary := $page.Params.summary | default $page.Summary -}}
{{- $date := $page.Date -}}
{{- $permalink := $page.RelPermalink -}}
{{- $category := index ($page.Params.categories | default slice) 0 -}}
{{- $format := index ($page.Params.formats | default slice) 0 -}}

{{- /* Check for featured image */ -}}
{{- $image := "" -}}
{{- $imageAlt := "" -}}
{{- with $page.Resources.GetMatch "featured*" -}}
  {{- $image = .RelPermalink -}}
  {{- $imageAlt = .Title | default $title -}}
{{- else -}}
  {{- with $page.Params.image -}}
    {{- $image = . -}}
    {{- $imageAlt = $page.Params.image_alt | default $title -}}
  {{- end -}}
{{- end -}}

<article class="card card-article" itemscope itemtype="https://schema.org/Article">
  <a href="{{ $permalink }}" class="card-link" aria-label="CiteÈ™te articolul: {{ $title }}">
    {{- if $image -}}
      <div class="card-media">
        {{- /* Try to get page resource for responsive images */ -}}
        {{- $res := $page.Resources.GetMatch "featured*" -}}
        {{- if and $res (ne $res.MediaType.SubType "svg") -}}
          {{- $lg := $res.Fit "800x450 webp" | resources.Fingerprint -}}
          {{- $md := $res.Fit "600x338 webp" | resources.Fingerprint -}}
          {{- $sm := $res.Fit "400x225 webp" | resources.Fingerprint -}}
          <img src="{{ $lg.RelPermalink }}" 
               srcset="{{ $sm.RelPermalink }} 400w, {{ $md.RelPermalink }} 600w, {{ $lg.RelPermalink }} 800w" 
               sizes="(max-width: 30rem) 100vw, (max-width: 50rem) 50vw, 25rem" 
               alt="{{ $imageAlt }}" 
               loading="lazy"
               itemprop="image"
               class="card-image"
               width="800"
               height="450"
               decoding="async">
        {{- else -}}
          <img src="{{ $image }}" 
               alt="{{ $imageAlt }}" 
               loading="lazy"
               itemprop="image"
               class="card-image"
               width="400"
               height="225"
               decoding="async">
        {{- end -}}
      </div>
    {{- else -}}
      <div class="card-media card-media-placeholder" aria-hidden="true">
        <svg class="card-placeholder-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
          <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
          <polyline points="21,15 16,10 5,21" stroke="currentColor" stroke-width="2"/>
        </svg>
      </div>
    {{- end -}}
    
    <div class="card-content">
      <div class="card-meta">
        {{- partial "pills.html" (dict "category" $category "format" $format "size" "small") -}}
        <time datetime="{{ $date.Format "2006-01-02T15:04:05Z07:00" }}" 
              itemprop="datePublished"
              class="card-date">
          {{- $date.Format "2 Jan" -}}
        </time>
      </div>
      
      <h3 class="card-title" itemprop="headline">{{ $title }}</h3>
      
      {{- if $summary -}}
        <p class="card-summary" itemprop="description">{{ $summary }}</p>
      {{- end -}}
    </div>
  </a>
</article>

{{- /* Card styles are now integrated into the main CSS design system */ -}}