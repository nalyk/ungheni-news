{{/* Rail: render N recent posts from a tag (optional), else generic recent. */}}
{{ $ctx := .ctx }}
{{ $title := .title }}
{{ $tag := .tag }}
{{ $limit := .limit | default 6 }}
{{ $sec := $ctx.GetPage (printf "/%s/news" $ctx.Site.Language.Lang) }}
{{ $pages := cond (ne $sec nil) (sort $sec.RegularPages "Date" "desc") (slice) }}
{{ if $tag }}
  {{ $pages = where $pages "Params.tags" "intersect" (slice $tag) }}
{{ end }}
{{ $pages = first $limit $pages }}
{{ if gt (len $pages) 0 }}
<section class="rail card">
  <h3>{{ $title }}</h3>
  <ul class="list thumb">
  {{ range $pages }}
    {{ $img := or .Params.cover (cond (in .Params.tags "politic") "/img/placeholders/politic.svg" (cond (in .Params.tags "sports") "/img/placeholders/politic.svg" (cond (in .Params.tags "education") "/img/placeholders/local.svg" "/img/placeholders/local.svg"))) }}
    {{ $res := .Resources.GetMatch $img | default (resources.Get $img) }}
    <li>
      <a class="thumb" href="{{ .RelPermalink }}">
        {{ if and $res (ne $res.MediaType.SubType "svg") }}
          {{ $lg := $res.Fill "600x400 webp" | resources.Fingerprint }}
          {{ $sm := $res.Fill "360x240 webp" | resources.Fingerprint }}
          <img src="{{ $sm.RelPermalink }}" srcset="{{ $sm.RelPermalink }} 360w, {{ $lg.RelPermalink }} 600w" sizes="(max-width: 48rem) 33vw, 180px" width="300" height="200" alt="" loading="lazy" />
        {{ else }}
          <img src="{{ $img }}" width="300" height="200" alt="" loading="lazy" />
        {{ end }}
      </a>
      <div class="item">
        <a class="title" href="{{ .RelPermalink }}">{{ .Title }}</a>
        <div class="meta">{{ .Date.Format "2006-01-02" }}</div>
      </div>
    </li>
  {{ end }}
  </ul>
</section>
{{ end }}
