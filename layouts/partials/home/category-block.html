{{ $category_slug := .category }}
{{ $limit := .limit | default 4 }}
{{ $lang_news_path := printf "/%s/news" .context.Site.Language.Lang }}
{{ $news_section := .context.Site.GetPage $lang_news_path }}

{{/* Build a robust page list where categories may be string or list */}}
{{ $.Scratch.Set "_cat_pages" (slice) }}
{{ range $p := $news_section.RegularPages }}
  {{ $rc := $p.Params.categories }}
  {{ $pc := cond (reflect.IsSlice $rc) $rc (slice $rc) }}
  {{ if in ($pc | default (slice)) $category_slug }}
    {{ $.Scratch.Add "_cat_pages" (slice $p) }}
  {{ end }}
{{ end }}
{{ $pages := first $limit ($.Scratch.Get "_cat_pages") }}

{{ if $pages }}
<section class="category-block">
  <h2 class="category-title"><a href="#">{{ i18n $category_slug | default $category_slug }}</a></h2>
  <div class="category-grid-{{ $limit }}">
    {{ range $i, $p := $pages }}
      {{ $card_class := "card-standard" }}
      {{ if eq $i 0 }}{{ $card_class = "card-featured" }}{{ end }}
      {{ partial "home/category-card.html" (dict "page" $p "card_class" $card_class) }}
    {{ end }}
  </div>
</section>
{{ end }}
