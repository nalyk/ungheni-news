{{ $category_slug := .category }}
{{ $limit := .limit | default 4 }}
{{ $lang_news_path := printf "/%s/news" .context.Site.Language.Lang }}
{{ $sec := .context.Site.GetPage $lang_news_path }}
{{ $all := cond (ne $sec nil) ($sec.RegularPages | default $sec.Pages) (slice) }}
{{ if eq (len $all) 0 }}
  {{ $lang_news_path := printf "/%s/news" .context.Site.Language.Lang }}
  {{ $sec := .context.Site.GetPage $lang_news_path }}
  {{ $all = cond (ne $sec nil) ($sec.RegularPages | default $sec.Pages) (slice) }}
{{ end }}

{{/* Build a robust page list where categories may be string or list */}}
{{ $.Scratch.Set "_cat_pages" (slice) }}
{{ range $p := $all }}
  {{ $rc := $p.Params.categories }}
  {{ $pc := cond (reflect.IsSlice $rc) $rc (slice $rc) }}
  {{ if in ($pc | default (slice)) $category_slug }}
    {{ $.Scratch.Add "_cat_pages" (slice $p) }}
  {{ end }}
{{ end }}
{{ $_cp := $.Scratch.Get "_cat_pages" | default (slice) }}
{{ $pages := first $limit $_cp }}

{{ if $pages }}
<section class="category-block">
  <h2 class="category-title"><a href="#">{{ i18n $category_slug | default $category_slug }}</a></h2>
  <div class="category-grid-{{ $limit }}">
    {{ range $i, $p := $pages }}
      {{ $card_class := "card-standard" }}
      {{ if eq $i 0 }}{{ $card_class = "card-featured" }}{{ end }}
      {{ partial "home/category-card.html" (dict "page" $p "card_class" $card_class) }}
    {{ end }}
  </div>
</section>
{{ end }}
