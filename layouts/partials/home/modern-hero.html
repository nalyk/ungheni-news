{{ $lang_news_path := printf "/%s/news" .Site.Language.Lang }}
{{ $news_section := .Site.GetPage $lang_news_path }}

{{/* Build robust slices for category membership regardless of string/list */}}
{{ $all := $news_section.RegularPages }}
{{ $local := slice }}
{{ $national := slice }}
{{ $service := slice }}
{{ range $p := $all }}
  {{ $rc := $p.Params.categories }}
  {{ $pc := cond (reflect.IsSlice $rc) $rc (slice $rc) }}
  {{ if in ($pc | default (slice)) "local" }}
    {{ $local = $local | append $p }}
  {{ end }}
  {{ if in ($pc | default (slice)) "national" }}
    {{ $national = $national | append $p }}
  {{ end }}
  {{ if in ($pc | default (slice)) "servicii-publice" }}
    {{ $service = $service | append $p }}
  {{ end }}
{{ end }}

{{/* 1. Most recent featured local article (if any) */}}
{{ $featured_local := where $local ".Params.featured" true }}
{{ $featured_story := first 1 $featured_local }}

{{/* 2. If no featured, prioritize local news with format 'stire' */}}
{{ $local_news_list := slice }}
{{ range $p := $local }}
  {{ $rf := $p.Params.formats }}
  {{ $pf := cond (reflect.IsSlice $rf) $rf (slice $rf) }}
  {{ if in ($pf | default (slice)) "stire" }}
    {{ $local_news_list = $local_news_list | append $p }}
  {{ end }}
{{ end }}
{{ $local_news := first 1 $local_news_list }}
{{ $local_story := $featured_story | default $local_news | default (first 1 $local) }}

{{/* 3. Latest national and service stories */}}
{{ $national_story := first 1 $national }}
{{ $service_story := first 1 $service }}

<section class="modern-hero">
  <div class="hero-grid">
    {{ with $local_story }}
      <div class="hero-main">
        {{ range . }}
          {{ partial "home/category-card.html" (dict "page" . "card_class" "card-hero-main") }}
        {{ end }}
      </div>
    {{ end }}
    <div class="hero-sub">
      {{ with $national_story }}
        {{ range . }}
          {{ partial "home/category-card.html" (dict "page" . "card_class" "card-hero-sub") }}
        {{ end }}
      {{ end }}
      {{ with $service_story }}
        {{ range . }}
          {{ partial "home/category-card.html" (dict "page" . "card_class" "card-hero-sub card-service-alert") }}
        {{ end }}
      {{ end }}
    </div>
  </div>
</section>
