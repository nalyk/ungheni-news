{{/* Use site section for the current language */}}
{{/* WORKAROUND: Extract language from URL since .Site.Language.Lang returns default lang */}}
{{ $url_parts := split .RelPermalink "/" }}
{{ $lang := index $url_parts 1 }}
{{ if not $lang }}{{ $lang = .Site.Language.Lang }}{{ end }}
{{/* WORKAROUND: .Site.GetPage doesn't work for non-default language sections, use AllPages filter */}}
{{ $lang_news_path := printf "/%s/news/" $lang }}
{{ $sec := index (where .Site.AllPages "RelPermalink" $lang_news_path) 0 }}
{{ $all := cond (ne $sec nil) ($sec.RegularPages | default $sec.Pages) (slice) }}
{{ $local_list  := union (where $all ".Params.categories" "intersect" (slice "local")) (where $all ".Params.categories" "eq" "local") }}
{{ $national_list := union (where $all ".Params.categories" "intersect" (slice "national")) (where $all ".Params.categories" "eq" "national") }}
{{ $service_list  := union (where $all ".Params.categories" "intersect" (slice "servicii-publice")) (where $all ".Params.categories" "eq" "servicii-publice") }}

{{/* 1. Most recent featured local article (if any) */}}
{{ $featured_local := where $local_list ".Params.featured" true }}
{{ $featured_story := first 1 $featured_local }}

{{/* 2. If no featured, prioritize local news with format 'stire' */}}
{{ $local_news_list := union (where $local_list ".Params.formats" "intersect" (slice "stire")) (where $local_list ".Params.formats" "eq" "stire") }}
{{ $local_news := first 1 $local_news_list }}
{{ $local_story := $featured_story | default $local_news | default (first 1 $local_list) }}
{{ if not $local_story }}
  {{ $local_story = first 1 ($all.ByDate.Reverse) }}
{{ end }}

{{/* 3. Latest national and service stories */}}
{{ $national_story := first 1 $national_list }}
{{ $service_story := first 1 $service_list }}

<section class="modern-hero">
  <div class="hero-grid">
    {{ with $local_story }}
      <div class="hero-main">
        {{ range . }}
          {{ partial "home/hero-card.html" (dict "page" . "card_class" "card-hero-main") }}
        {{ end }}
      </div>
    {{ end }}
    <div class="hero-sub">
      {{ with $national_story }}
        {{ range . }}
          {{ partial "home/hero-card.html" (dict "page" . "card_class" "card-hero-sub") }}
        {{ end }}
      {{ end }}
      {{ with $service_story }}
        {{ range . }}
          {{ partial "home/hero-card.html" (dict "page" . "card_class" "card-hero-sub card-service-alert") }}
        {{ end }}
      {{ end }}
    </div>
  </div>
</section>
